<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–û–Ω–ª–∞–π–Ω –º–∞–≥–∞–∑–∏–Ω –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤</title>
  <link rel="stylesheet" href="/css/style.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#fafafa">

  <style>
    .auth-bar {
      position: fixed;
      top: 0;
      right: 0;
      background-color: #ffffffee;
      border-bottom-left-radius: 12px;
      padding: 10px 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .auth-bar span {
      color: #333;
      font-weight: bold;
    }

    .auth-bar button {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
    }

    #comments-section {
      background-color: #f9f9f9;
      padding: 20px;
      margin-top: 30px;
      border-radius: 8px;
    }

    #comments-section textarea {
      width: 100%;
      height: 80px;
      margin-top: 10px;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
      resize: vertical;
    }

    #comments-section button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>

<body>
<header>
  <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –º–∞–≥–∞–∑–∏–Ω –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤</h1>
  <nav>
    <ul>
      <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
      <li><a href="#catalog">–ö–∞—Ç–∞–ª–æ–≥</a></li>
      <li><a href="contacts.html">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
      <li><a href="cart.html">–ö–æ—Ä–∑–∏–Ω–∞</a></li>
    </ul>
  </nav>
</header>

<!-- –ü–∞–Ω–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
<div id="auth-bar" class="auth-bar"></div>

<div class="layout">
  <aside class="filters">
    <h2>–§–∏–ª—å—Ç—Ä</h2>
    <div class="filter-group">
      <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</h3>
      <label><input type="checkbox" name="category" value="laptop" /> üíª –ù–æ—É—Ç–±—É–∫–∏</label>
      <label><input type="checkbox" name="category" value="desktop" /> üñ•Ô∏è –ü–ö</label>
      <label><input type="checkbox" name="category" value="accessory" /> üéß –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</label>
    </div>
    <div class="filter-group">
      <h3>–¶–µ–Ω–∞</h3>
      <label><input type="checkbox" name="price" value="low" /> üí∏ –î–æ 100000</label>
      <label><input type="checkbox" name="price" value="mid" /> üíµ 100000‚Äì200000</label>
      <label><input type="checkbox" name="price" value="high" /> üíé –ë–æ–ª–µ–µ 200000</label>
    </div>
  </aside>

  <section class="products" id="catalog">
    <!-- –¢–æ–≤–∞—Ä—ã –∑–¥–µ—Å—å -->

    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
    <div id="comments-section">
      <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
      <div id="comments-list"></div>
      <textarea id="comment-content" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
      <button onclick="submitComment()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </section>
</div>

<div id="product-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">√ó</span>
    <img id="modal-image" src="" alt="Product Image" />
    <h2 id="modal-title"></h2>
    <p id="modal-description"></p>
    <p id="modal-price"></p>

    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä—è–º–æ –≤–Ω—É—Ç—Ä–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
    <div id="comments-section">
      <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
      <div id="comments-list"></div>
      <textarea id="comment-content" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
      <button onclick="submitComment()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>
</div>


<script>
  async function checkAuth() {
    const response = await fetch('/api/user/me', {
      credentials: 'include'
    });

    const authDiv = document.getElementById('auth-bar');

    if (response.ok) {
      const user = await response.json();
      authDiv.innerHTML = `
        <span>–ü—Ä–∏–≤–µ—Ç, ${user.username}!</span>
        <button onclick="logout()">–í—ã–π—Ç–∏</button>
      `;
    } else {
      authDiv.innerHTML = `
        <a href="/login">–í–æ–π—Ç–∏</a> |
        <a href="/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
      `;
    }
  }

  function logout() {
    fetch('/logout', { method: 'POST' })
            .then(() => location.reload());
  }

  checkAuth();
</script>

<script>
  const productId = 1; // –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

  async function loadComments() {
    const response = await fetch(`/api/comments/${productId}`);
    const comments = await response.json();
    const list = document.getElementById('comments-list');
    list.innerHTML = comments.map(c =>
            `<div><strong>${c.user.username}</strong>: ${c.content}</div>`
    ).join('');
  }

  async function submitComment() {
    const content = document.getElementById('comment-content').value;
    await fetch('/api/comments', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ content, productId })
    });
    document.getElementById('comment-content').value = '';
    loadComments();
  }

  loadComments();
</script>

<footer>
  <p>&copy; 2025 –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤</p>
</footer>

<script src="/js/app.js"></script>
</body>
</html>
